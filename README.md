# 自行车管理系统项目文档

## 1. 项目概述

### 1.1 项目简介
自行车管理系统是一个基于Spring Boot开发的后端服务，用于管理自行车的租借、归还、共享等功能。系统支持用户注册、登录、自行车管理、停车位管理以及租借记录查询等功能。

### 1.2 技术栈
- **后端框架**: Spring Boot
- **安全认证**: Spring Security + JWT
- **数据库操作**: MyBatis-Plus
- **API文档**: Swagger
- **数据库**: MySQL
- **项目构建**: Maven

### 1.3 系统功能
- 用户管理：注册、登录、信息更新、删除
- 自行车管理：添加、更新、删除、查询
- 停车位管理：查询、更新、存车/还车、取车/借车
- 记录管理：查询订单记录

## 2. 系统架构

### 2.1 架构图
```
+------------------+
|     客户端        |
+--------+---------+
         |
         v
+--------+---------+
|   控制器层(API)   |
+--------+---------+
         |
         v
+--------+---------+
|     服务层        |
+--------+---------+
         |
         v
+--------+---------+
|     数据访问层    |
+--------+---------+
         |
         v
+--------+---------+
|     数据库        |
+------------------+
```

### 2.2 模块说明
- **controller**: 控制器层，处理HTTP请求
- **service**: 服务层，实现业务逻辑
- **mapper**: 数据访问层，与数据库交互
- **entity**: 实体类，对应数据库表
- **dto**: 数据传输对象，用于前后端数据交互
- **config**: 配置类，包括安全配置、Swagger配置等
- **filter**: 过滤器，包括JWT认证过滤器、跨域过滤器等
- **util**: 工具类，包括JWT工具、音频处理工具等

## 3. 数据库设计

### 3.1 数据库表结构

#### 3.1.1 用户表(user)
| 字段名 | 类型 | 说明 |
|-------|------|------|
| userid | int | 主键，用户ID |
| username | varchar | 用户名 |
| logintext | varchar | 登录账号 |
| password | varchar | 密码 |
| voice | varchar | 语音特征 |
| hand | varchar | 手势特征 |
| avatar | varchar | 头像URL |
| usebikeid | int | 使用的自行车ID |
| nowborrow | int | 当前是否借车(0:否, 1:是) |

#### 3.1.2 自行车表(bike)
| 字段名 | 类型 | 说明 |
|-------|------|------|
| bikeid | int | 主键，自行车ID |
| status | int | 状态(0:可用, 1:不可用) |
| type | varchar | 类型(private:私有, share:共享) |
| bikename | varchar | 自行车名称 |
| userid | int | 当前使用者ID |
| parkingid | int | 停车位ID |
| ownerid | int | 所有者ID |

#### 3.1.3 停车位表(parking)
| 字段名 | 类型 | 说明 |
|-------|------|------|
| parkingid | int | 主键，停车位ID |
| bikeid | int | 自行车ID |
| status | int | 状态(0:空闲, 1:已占用, 2:共享) |
| recordid | int | 记录ID |

#### 3.1.4 记录表(record)
| 字段名 | 类型 | 说明 |
|-------|------|------|
| recordid | int | 主键，记录ID |
| bikeid | int | 自行车ID |
| userid | int | 用户ID |
| type | varchar | 类型(borrow:借车, return:还车) |
| starttime | datetime | 开始时间 |
| endtime | datetime | 结束时间 |
| money | decimal | 金额 |
| sparkingid | int | 起始停车位ID |
| eparkingid | int | 结束停车位ID |
| touser | int | 目标用户ID |

### 3.2 表关系
- 用户与自行车：一对多关系，一个用户可以拥有多辆自行车
- 自行车与停车位：一对一关系，一辆自行车只能停在一个停车位
- 用户与记录：一对多关系，一个用户可以有多条记录
- 自行车与记录：一对多关系，一辆自行车可以有多条记录

## 4. 业务流程

### 4.1 用户注册与登录流程
1. 用户注册：提供账号和密码，系统创建用户记录
2. 用户登录：提供账号和密码，系统验证后返回JWT令牌
3. 人脸登录：提供用户ID，系统验证后返回JWT令牌

### 4.2 自行车管理流程
1. 添加自行车：用户添加自己的自行车
2. 更新自行车：用户更新自己的自行车信息，可以将私有自行车设为共享
3. 删除自行车：用户删除自己的自行车

### 4.3 停车位管理流程
1. 存车：用户将自行车存放到停车位
2. 取车：用户从停车位取走自己的自行车
3. 借车：用户借用共享状态的自行车
4. 还车：用户归还借用的自行车

### 4.4 记录管理流程
1. 借车时创建记录：记录借车的时间、地点等信息
2. 还车时更新记录：记录还车的时间、地点等信息，计算费用
3. 查询记录：用户查询自己的借车、还车记录

## 5. 安全设计

### 5.1 认证与授权
- 使用JWT进行用户认证
- 使用Spring Security进行授权控制
- 所有需要认证的API都需要在请求头中携带有效的JWT令牌

### 5.2 密码安全
- 用户密码使用加密算法存储
- 登录时验证密码的有效性

### 5.3 接口安全
- 使用HTTPS协议保证传输安全
- 实现跨域过滤器，控制跨域访问
- 对敏感操作进行权限验证

## 6. 部署说明

### 6.1 环境要求
- JDK 1.8+
- MySQL 5.7+
- Maven 3.6+

### 6.2 部署步骤
1. 克隆项目代码
2. 配置数据库连接信息(application.yml)
3. 使用Maven构建项目：`mvn clean package`
4. 运行生成的JAR包：`java -jar target/zxyz.jar`

### 6.3 配置说明
主要配置文件为`application.yml`，包含以下配置项：
- 服务器端口
- 数据库连接信息
- JWT配置
- 日志配置

## 7. 测试说明

### 7.1 单元测试
- 使用JUnit进行单元测试
- 测试覆盖控制器层、服务层和数据访问层

### 7.2 接口测试
- 使用Postman或其他API测试工具进行接口测试
- 测试各个API的功能、参数验证和错误处理

### 7.3 性能测试
- 使用JMeter进行性能测试
- 测试系统在高并发情况下的表现

## 8. 维护与扩展

### 8.1 日志管理
- 系统使用SLF4J+Logback进行日志记录
- 记录关键操作和错误信息，便于问题排查

### 8.2 扩展建议
- 添加用户角色管理，实现不同角色的权限控制
- 增加支付功能，实现自行车租借的在线支付
- 添加消息通知功能，通知用户租借状态变更
- 实现数据统计分析功能，提供使用情况报表