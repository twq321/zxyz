# ParkingController API 功能测试表格

## API 概述
ParkingController 提供了停车位管理相关的 API，包括查询停车位、更新停车位信息、存车/还车以及取车/借车等功能。

## 功能测试表格

| 序号 | API 接口 | HTTP 方法 | URL 路径 | 请求参数 | 预期响应 | 测试场景 | 测试步骤 | 预期结果 |
|------|---------|----------|---------|---------|---------|---------|---------|---------|
| 1 | 查找所有车位 | GET | /parking | 请求参数：groupId=1 | 返回指定组ID的停车位列表 | 1.1 有效的组ID | 1. 发送包含有效组ID的请求<br>2. 检查响应状态码和内容 | 状态码：200 OK<br>响应体：包含停车位列表的JSON数组 |
| 2 | 查找所有车位 | GET | /parking | 请求参数：groupId=999（不存在的组ID） | 返回空列表 | 1.2 不存在的组ID | 1. 发送包含不存在组ID的请求<br>2. 检查响应状态码和内容 | 状态码：200 OK<br>响应体：空数组 [] |
| 3 | 查找所有车位 | GET | /parking | 无请求参数 | 返回错误 | 1.3 缺少必要参数 | 1. 发送不包含组ID的请求<br>2. 检查响应状态码和内容 | 状态码：400 Bad Request<br>响应体：错误信息 |
| 4 | 更新停车位 | PUT | /parking/update | 请求参数：包含停车位信息的Parking对象 | 返回更新结果 | 2.1 有效的停车位信息 | 1. 发送包含有效停车位信息的请求<br>2. 检查响应状态码和内容 | 状态码：200 OK<br>响应体：更新成功的记录数 |
| 5 | 更新停车位 | PUT | /parking/update | 请求参数：包含不存在的停车位ID的Parking对象 | 返回更新结果 | 2.2 不存在的停车位ID | 1. 发送包含不存在停车位ID的请求<br>2. 检查响应状态码和内容 | 状态码：200 OK<br>响应体：0（表示没有记录被更新） |
| 6 | 存车/还车 | POST | /parking/park | 请求体：```{"parkingId": 1, "bikeId": 1}```<br>用户当前未借车（nowborrow=0） | 返回操作结果 | 3.1 存车 - 有效的停车位和自行车ID | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：200 OK<br>响应体："操作成功." |
| 7 | 存车/还车 | POST | /parking/park | 请求体：```{"parkingId": 1, "bikeId": 1}```<br>停车位已满（status=1） | 返回错误 | 3.2 存车 - 停车位已满 | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：400 Bad Request<br>响应体："操作失败, 车位已满." |
| 8 | 存车/还车 | POST | /parking/park | 请求体：```{"parkingId": 1}```<br>用户当前已借车（nowborrow=1） | 返回操作结果 | 3.3 还车 - 有效的停车位ID | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：200 OK<br>响应体："操作成功." |
| 9 | 存车/还车 | POST | /parking/park | 请求体：```{"parkingId": 1}```<br>停车位已满（status=1） | 返回错误 | 3.4 还车 - 停车位已满 | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：400 Bad Request<br>响应体："操作失败, 车位已满." |
| 10 | 存车/还车 | POST | /parking/park | 请求体：```{"parkingId": 999}```（不存在的停车位ID） | 返回错误 | 3.5 存车/还车 - 不存在的停车位ID | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：400 Bad Request 或 500 Internal Server Error<br>响应体：错误信息 |
| 11 | 取车/借车 | POST | /parking/borrow | 请求体：```{"parkingId": 1}```<br>用户未借车（nowborrow=0）<br>停车位有自行车（bikeid≠0）<br>自行车不属于用户<br>停车位状态为共享（status=2） | 返回操作结果 | 4.1 借车 - 有效的停车位ID和共享自行车 | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：200 OK<br>响应体：操作成功的记录数 |
| 12 | 取车/借车 | POST | /parking/borrow | 请求体：```{"parkingId": 1}```<br>用户已借车（nowborrow=1） | 返回错误 | 4.2 借车 - 用户已有未还的自行车 | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：400 Bad Request<br>响应体："操作失败, 还有自行车未还." |
| 13 | 取车/借车 | POST | /parking/borrow | 请求体：```{"parkingId": 1}```<br>停车位无自行车（bikeid=0） | 返回错误 | 4.3 借车 - 停车位为空 | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：400 Bad Request<br>响应体："操作失败, 车位为空." |
| 14 | 取车/借车 | POST | /parking/borrow | 请求体：```{"parkingId": 1}```<br>停车位有自行车（bikeid≠0）<br>自行车不属于用户<br>停车位有未完成订单（recordid≠0） | 返回错误 | 4.4 借车 - 自行车有未完成订单 | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：400 Bad Request<br>响应体："操作失败, 自行车还有订单." |
| 15 | 取车/借车 | POST | /parking/borrow | 请求体：```{"parkingId": 1}```<br>停车位有自行车（bikeid≠0）<br>自行车不属于用户<br>停车位状态为不可取（status=1） | 返回错误 | 4.5 借车 - 自行车不可取 | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：400 Bad Request<br>响应体："操作失败, 自行车不可取." |
| 16 | 取车/借车 | POST | /parking/borrow | 请求体：```{"parkingId": 1}```<br>用户未借车（nowborrow=0）<br>停车位有自行车（bikeid≠0）<br>自行车属于用户<br>停车位状态为共享（status=2） | 返回操作结果 | 4.6 取车 - 共享状态的自己的车 | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：200 OK<br>响应体：操作成功的记录数 |
| 17 | 取车/借车 | POST | /parking/borrow | 请求体：```{"parkingId": 1}```<br>用户未借车（nowborrow=0）<br>停车位有自行车（bikeid≠0）<br>自行车属于用户<br>停车位状态为停车（status=1） | 返回操作结果 | 4.7 取车 - 停车状态的自己的车 | 1. 使用有效的JWT令牌发送请求<br>2. 检查响应状态码和内容 | 状态码：200 OK<br>响应体：操作成功的记录数 |

## 测试注意事项

1. **认证要求**：除了查询停车位接口外，其他接口都需要JWT令牌认证
2. **数据准备**：测试前需要准备测试数据，包括用户账号、自行车信息、停车位信息等
3. **测试顺序**：建议按照查询 -> 存车 -> 取车/借车 -> 还车的顺序进行测试
4. **状态测试**：停车位有多种状态（空闲、已占用、共享），需要测试不同状态下的操作
5. **用户状态测试**：用户有不同的借车状态（已借车、未借车），需要测试不同状态下的操作
6. **所有权测试**：需要测试用户对自行车的所有权对操作的影响
7. **边界测试**：应测试各种边界情况，如不存在的ID、无效的状态值等
8. **安全测试**：应测试未授权访问、越权操作等安全问题
9. **并发测试**：可测试多用户同时操作同一停车位的情况

## 测试环境要求

1. 后端服务已正确部署并运行
2. 数据库已正确配置并包含必要的表结构
3. 测试工具（如Postman、JMeter等）已准备就绪
4. 已创建测试用户并获取有效的JWT令牌